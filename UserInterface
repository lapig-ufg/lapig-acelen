//Import modules
var run = require('users/Amazonas21/acelen:runclassification')
var styles = require('users/Amazonas21/acelen:styles')

//Variables
var classrf

var app = {
          gui:function(maplayer){
            
            //Panel of choose pasture type for classification in map
            //Split Tools
            var lblClass = ui.Label({
                        value:'CLASSIFICAÇÃO AUTOMÁTICA DE PASTAGEM - SENTINEL',
                        style:{fontSize:'20',fontWeight:'bold'}
            })
            var lblType = ui.Label('Tipo de pastagem')
            var selType = ui.Select({
              items:['Cultivada'],
              placeholder:'Escolha o tipo'
            })
            var pnTypePasture = ui.Panel([lblType,selType],
                        ui.Panel.Layout.Flow('horizontal'),
                        {stretch: 'both'}
            )
            
            //Panel of choose the year for classification in map
            var lblYear = ui.Label('Ano da análise')
            var selYear = ui.Select({
              items:['2018','2019','2020','2021','2022'],
              placeholder:'Escolha o ano'
            })
            var pnYear = ui.Panel([lblYear,selYear],
                        ui.Panel.Layout.Flow('horizontal'),
                        {stretch: 'both'}
            )
            
            //Panel of choose the year for classification in map
            var lblFarm = ui.Label('Nome da área')
            var selFarm = ui.Textbox({
              placeholder:'Área',
              style:{'width':'120px'}
            })
            var pnFarm = ui.Panel([lblFarm,selFarm],
                        ui.Panel.Layout.Flow('horizontal'),
                        {stretch: 'both'}
            )
            
            var btnClassify = ui.Button({label:'Classificação da área'})
                btnClassify.onClick(function(){
                    var typegrass = selType.getValue()
                    var year = ee.Number.parse(selYear.getValue()).getInfo()
                    var farm = selFarm.getValue().toUpperCase()
                    
                    classrf = run.getRun(typegrass,year,farm,maplayer)
                    classrf = classrf['classification']
                    
                    maplayer.addLayer(classrf,style.styleclass,'Classification')
                    maplayer.centerObject(classrf)
                    
                })
            
            //Panel GPP trend
            //Split Tools
            var lblTool = ui.Label({
                        value:'PRODUTIVIDADE PRIMÁRIA BRUTA (GPP)',
                        style:{fontSize:'20',fontWeight:'bold'}
            })
            //GPP Initial
            var lblGPPInitial = ui.Label('Ano Inicial')
            var selGPPInitial = ui.Select({
              placeholder:'Selecione o ano',
              items:styles.gppyears,
              style:{'width':'120px'}
            })
            var pnGPPInitial = ui.Panel([lblGPPInitial,selGPPInitial],
                        ui.Panel.Layout.Flow('horizontal'),
                        {stretch: 'both'}
            )
            
            //GPP Final
            var lblGPPFinal = ui.Label('Ano Final')
            var selGPPFinal = ui.Select({
              placeholder:'Selecione o ano',
              items:styles.gppyears,
              style:{'width':'120px'}
            })
            var pnGPPFinal = ui.Panel([lblGPPFinal,selGPPFinal],
                        ui.Panel.Layout.Flow('horizontal'),
                        {stretch: 'both'}
            )
            
            var btnGPP = ui.Button({label:'Visualização do GPP'})
            var btnTrendGPP = ui.Button({label:'Gerar a tendência do GPP'})
            
            //Insert all panels into main panel
            var listPanels = [lblClass,pnTypePasture,pnYear,
                              pnFarm,btnClassify,lblTool,
                              pnGPPInitial,pnGPPFinal,btnGPP,
                              btnTrendGPP]
            var painelMain = ui.Panel({style: {width: '270px',position:'top-left'}})
            
            for (var i in listPanels){
              painelMain.add(listPanels[i])
            }
            
            return painelMain
            
          },
          init:function(){
              
              //Create map from app
              function newMap(){
                var map = ui.Map().clear();
                    map.setOptions('SATELLITE');
                    map.setCenter(-53.23,-16.48, 4)
                    
                return map
              }
        
              var maplayer = newMap()
        
              //Load all guis
              var gui = app.gui(maplayer) 
              var mapPainel = maplayer.add(gui)
              //var listPanel = [gui,maplayer]
  
              //Merge all painels
              //var mapPainel = ui.Panel(listPanel,
              //    ui.Panel.Layout.Flow('horizontal'), 
              //    {stretch: 'both',height:'100%',width:'100%'}
              //); 
              ui.root.widgets().reset([mapPainel]);
          }
}
//Initialize app
app.init();